<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Vue topologique du réseau</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #0f1419; color: #f8f8f2; }
        header { padding: 20px; background: #1f2933; border-bottom: 1px solid #2d3741; }
        #workspace { display: flex; gap: 20px; flex-wrap: wrap; padding: 20px; }
        #network { flex: 2 1 600px; height: 70vh; border: 1px solid #2d3741; border-radius: 8px; background: #ffffff; }
        .panel { flex: 1 1 260px; background: #1f2933; padding: 15px; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.4); }
        .panel h2 { margin-top: 0; color: #58a6ff; }
        label { display: block; margin: 12px 0 6px; font-size: 0.9rem; }
        input, select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #374151; background: #111827; color: #f8f8f2; }
        button { margin-top: 12px; padding: 10px; width: 100%; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button.primary { background: #2563eb; color: #fff; }
        button.danger { background: #dc2626; color: #fff; }
        button.secondary { background: #4b5563; color: #fff; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .summary { margin: 0 20px 20px; background: #1f2933; padding: 15px; border-radius: 8px; }
        .summary strong { color: #58a6ff; }
        #editor-status { font-style: italic; color: #9ca3af; }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/vis-network/styles/vis-network.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
    <header>
        <h1>Topologie réseau - générée le 2025-12-05T11:54:36.756831</h1>
        <p>Scanner: panoptis · Hôtes analysés: 12</p>
    </header>
    <div id="workspace">
        <div id="network"></div>
        <div class="panel">
            <h2>Édition du nœud</h2>
            <p id="editor-status">Sélectionnez un nœud dans le graphe.</p>
            <label for="node-label">Nom affiché</label>
            <input id="node-label" type="text" placeholder="Nom du nœud" />
            <label for="node-type">Type de noeud</label>
            <select id="node-type"></select>
            <button id="update-node" class="primary" disabled>Mettre à jour</button>
            <button id="delete-node" class="danger" disabled>Supprimer</button>
            <button id="toggle-hops" class="secondary" type="button">Masquer les liens intermédiaires</button>
        </div>
    </div>
    <div class="summary">
        <strong>Chemins observés:</strong>
        <ul>
            <li>10.0.10.1 &rarr; Chemin non disponible</li><li>10.0.10.10 &rarr; 10.0.10.10</li><li>10.0.10.100 &rarr; 10.0.10.100</li><li>10.0.10.101 &rarr; 10.0.1.1 &rarr; 10.0.10.101</li><li>10.0.10.106 &rarr; 10.0.10.106</li><li>10.0.10.20 &rarr; 10.0.1.1 &rarr; 10.0.10.20</li><li>10.0.10.200 &rarr; Chemin non disponible</li><li>10.0.10.50 &rarr; 10.0.1.1 &rarr; 10.0.10.50</li><li>10.0.10.53 &rarr; 10.0.1.1 &rarr; 10.0.10.53</li><li>10.0.10.54 &rarr; 10.0.10.54</li><li>10.0.10.55 &rarr; 10.0.1.1 &rarr; 10.0.10.55</li><li>10.0.10.56 &rarr; 10.0.10.56</li>
        </ul>
    </div>
    <script>
        const topologyData = {"generated_at": "2025-12-05T11:54:36.756831", "scanner": "panoptis", "hosts": ["10.0.10.1", "10.0.10.10", "10.0.10.100", "10.0.10.101", "10.0.10.106", "10.0.10.20", "10.0.10.200", "10.0.10.50", "10.0.10.53", "10.0.10.54", "10.0.10.55", "10.0.10.56"], "paths": [{"host": "10.0.10.1", "hops": []}, {"host": "10.0.10.10", "hops": ["10.0.10.10"]}, {"host": "10.0.10.100", "hops": ["10.0.10.100"]}, {"host": "10.0.10.101", "hops": ["10.0.1.1", "10.0.10.101"]}, {"host": "10.0.10.106", "hops": ["10.0.10.106"]}, {"host": "10.0.10.20", "hops": ["10.0.1.1", "10.0.10.20"]}, {"host": "10.0.10.200", "hops": []}, {"host": "10.0.10.50", "hops": ["10.0.1.1", "10.0.10.50"]}, {"host": "10.0.10.53", "hops": ["10.0.1.1", "10.0.10.53"]}, {"host": "10.0.10.54", "hops": ["10.0.10.54"]}, {"host": "10.0.10.55", "hops": ["10.0.1.1", "10.0.10.55"]}, {"host": "10.0.10.56", "hops": ["10.0.10.56"]}], "nodes": [{"id": "scanner_local", "label": "Scanner\npanoptis", "group": "scanner", "shape": "icon", "title": "Noeud scanner (panoptis)", "icon": {"face": "FontAwesome", "code": "\uf109", "size": 40, "color": "#f97316"}, "node_type": "scanner", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#f97316", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#f97316", "background": "rgba(255,255,255,0.08)"}}, "level": 0}, {"id": "10.0.10.0/24", "label": "10.0.10.0/24", "group": "network", "shape": "icon", "title": "R\u00e9seau d\u00e9clar\u00e9 10.0.10.0/24", "icon": {"face": "FontAwesome", "code": "\uf0ac", "size": 32, "color": "#22d3ee"}, "node_type": "network", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#22d3ee", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#22d3ee", "background": "rgba(255,255,255,0.08)"}}, "level": 1}, {"id": "10.0.10.1", "label": "10.0.10.1", "group": "unknown", "shape": "icon", "title": "10.0.10.1", "icon": {"face": "FontAwesome", "code": "\uf128", "size": 28, "color": "#94a3b8"}, "node_type": "unknown", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#94a3b8", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#94a3b8", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, {"id": "10.0.10.10", "label": "10.0.10.10", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.10", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.100", "label": "10.0.10.100", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.100", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.101", "label": "10.0.10.101", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.101", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.1.1", "label": "10.0.1.1", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.1.1", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.106", "label": "10.0.10.106", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.106", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.20", "label": "10.0.10.20", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.20", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.200", "label": "10.0.10.200", "group": "unknown", "shape": "icon", "title": "10.0.10.200", "icon": {"face": "FontAwesome", "code": "\uf128", "size": 28, "color": "#94a3b8"}, "node_type": "unknown", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#94a3b8", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#94a3b8", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, {"id": "10.0.10.50", "label": "10.0.10.50", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.50", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.53", "label": "10.0.10.53", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.53", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.54", "label": "10.0.10.54", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.54", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.55", "label": "10.0.10.55", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.55", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, {"id": "10.0.10.56", "label": "10.0.10.56", "group": "gateway", "shape": "icon", "title": "Saut interm\u00e9diaire 10.0.10.56", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "node_type": "gateway", "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}], "edges": [{"id": "edge_0", "from": "scanner_local", "to": "10.0.10.1"}, {"id": "edge_1", "from": "scanner_local", "to": "10.0.10.10"}, {"id": "edge_2", "from": "scanner_local", "to": "10.0.10.100"}, {"id": "edge_3", "from": "scanner_local", "to": "10.0.1.1"}, {"id": "edge_4", "from": "scanner_local", "to": "10.0.10.106"}, {"id": "edge_5", "from": "scanner_local", "to": "10.0.10.200"}, {"id": "edge_6", "from": "scanner_local", "to": "10.0.10.54"}, {"id": "edge_7", "from": "scanner_local", "to": "10.0.10.56"}, {"id": "edge_8", "from": "10.0.10.0/24", "to": "10.0.10.1"}, {"id": "edge_9", "from": "10.0.10.0/24", "to": "10.0.10.10"}, {"id": "edge_10", "from": "10.0.10.0/24", "to": "10.0.10.100"}, {"id": "edge_11", "from": "10.0.10.0/24", "to": "10.0.10.101"}, {"id": "edge_12", "from": "10.0.10.0/24", "to": "10.0.10.106"}, {"id": "edge_13", "from": "10.0.10.0/24", "to": "10.0.10.20"}, {"id": "edge_14", "from": "10.0.10.0/24", "to": "10.0.10.200"}, {"id": "edge_15", "from": "10.0.10.0/24", "to": "10.0.10.50"}, {"id": "edge_16", "from": "10.0.10.0/24", "to": "10.0.10.53"}, {"id": "edge_17", "from": "10.0.10.0/24", "to": "10.0.10.54"}, {"id": "edge_18", "from": "10.0.10.0/24", "to": "10.0.10.55"}, {"id": "edge_19", "from": "10.0.10.0/24", "to": "10.0.10.56"}, {"id": "edge_20", "from": "10.0.10.10", "to": "10.0.10.10"}, {"id": "edge_21", "from": "10.0.10.100", "to": "10.0.10.100"}, {"id": "edge_22", "from": "10.0.10.101", "to": "10.0.1.1"}, {"id": "edge_23", "from": "10.0.10.101", "to": "10.0.10.101"}, {"id": "edge_24", "from": "10.0.1.1", "to": "10.0.10.20"}, {"id": "edge_25", "from": "10.0.1.1", "to": "10.0.10.50"}, {"id": "edge_26", "from": "10.0.1.1", "to": "10.0.10.53"}, {"id": "edge_27", "from": "10.0.1.1", "to": "10.0.10.55"}, {"id": "edge_28", "from": "10.0.10.106", "to": "10.0.10.106"}, {"id": "edge_29", "from": "10.0.10.20", "to": "10.0.10.20"}, {"id": "edge_30", "from": "10.0.10.50", "to": "10.0.10.50"}, {"id": "edge_31", "from": "10.0.10.53", "to": "10.0.10.53"}, {"id": "edge_32", "from": "10.0.10.54", "to": "10.0.10.54"}, {"id": "edge_33", "from": "10.0.10.55", "to": "10.0.10.55"}, {"id": "edge_34", "from": "10.0.10.56", "to": "10.0.10.56"}], "node_types": {"scanner": {"display": "Scanner", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf109", "size": 40, "color": "#f97316"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#f97316", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#f97316", "background": "rgba(255,255,255,0.08)"}}, "level": 0}, "network": {"display": "R\u00e9seau", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf0ac", "size": 32, "color": "#22d3ee"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#22d3ee", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#22d3ee", "background": "rgba(255,255,255,0.08)"}}, "level": 1}, "gateway": {"display": "Passerelle", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf6ff", "size": 30, "color": "#a78bfa"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#a78bfa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#a78bfa", "background": "rgba(255,255,255,0.08)"}}, "level": 2}, "domain_controller": {"display": "Contr\u00f4leur de domaine", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf233", "size": 34, "color": "#fb7185"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#fb7185", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#fb7185", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "windows": {"display": "H\u00f4te Windows", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf17a", "size": 32, "color": "#38bdf8"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#38bdf8", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#38bdf8", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "linux": {"display": "H\u00f4te Linux", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf17c", "size": 32, "color": "#4ade80"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#4ade80", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#4ade80", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "web": {"display": "Serveur Web", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf0ac", "size": 30, "color": "#fbbf24"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#fbbf24", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#fbbf24", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "dns": {"display": "Serveur DNS", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf124", "size": 30, "color": "#f472b6"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#f472b6", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#f472b6", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "mail": {"display": "Serveur Mail", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf0e0", "size": 30, "color": "#60a5fa"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#60a5fa", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#60a5fa", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "database": {"display": "Base de donn\u00e9es", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf1c0", "size": 30, "color": "#34d399"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#34d399", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#34d399", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "host": {"display": "H\u00f4te g\u00e9n\u00e9rique", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf233", "size": 28, "color": "#f5f5f4"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#f5f5f4", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#f5f5f4", "background": "rgba(255,255,255,0.08)"}}, "level": 3}, "unknown": {"display": "Inconnu", "shape": "icon", "icon": {"face": "FontAwesome", "code": "\uf128", "size": 28, "color": "#94a3b8"}, "color": {"border": "rgba(0,0,0,0)", "background": "rgba(0,0,0,0)", "highlight": {"border": "#94a3b8", "background": "rgba(255,255,255,0.06)"}, "hover": {"border": "#94a3b8", "background": "rgba(255,255,255,0.08)"}}, "level": 3}}};
        const NODE_TYPES = topologyData.node_types || {};
        const nodes = new vis.DataSet(topologyData.nodes);
        const edges = new vis.DataSet(topologyData.edges);
        const container = document.getElementById('network');
        const options = {
            layout: {
                hierarchical: {
                    enabled: true,
                    direction: 'LR',
                    levelSeparation: 200,
                    nodeSpacing: 180,
                    sortMethod: 'directed'
                }
            },
            interaction: {
                hover: true,
                tooltipDelay: 200
            },
            physics: false,
            nodes: {
                borderWidth: 0
            }
        };
        const network = new vis.Network(container, { nodes, edges }, options);

        const statusEl = document.getElementById('editor-status');
        const labelInput = document.getElementById('node-label');
        const typeSelect = document.getElementById('node-type');
        const updateBtn = document.getElementById('update-node');
        const deleteBtn = document.getElementById('delete-node');
        const toggleHopsBtn = document.getElementById('toggle-hops');
        let selectedNodeId = null;
        let currentNodeType = null;
        let simplifiedView = false;
        const baseEdgeIds = new Set(edges.getIds());
        const summaryEdgeIds = new Set();

        function populateTypeOptions() {
            typeSelect.innerHTML = '<option value="">-- Choisir --</option>';
            Object.keys(NODE_TYPES).forEach((kind) => {
                const option = document.createElement('option');
                option.value = kind;
                option.textContent = NODE_TYPES[kind].display || kind;
                typeSelect.appendChild(option);
            });
        }
        populateTypeOptions();

        function setEditorEnabled(enabled) {
            labelInput.disabled = !enabled;
            typeSelect.disabled = !enabled;
            updateBtn.disabled = !enabled;
            deleteBtn.disabled = !enabled;
        }

        function loadNodeData(nodeId) {
            const node = nodes.get(nodeId);
            labelInput.value = node.label || nodeId;
            const nodeType = node.node_type || node.group || 'unknown';
            typeSelect.value = nodeType;
            currentNodeType = nodeType;
            statusEl.textContent = 'Noeud sélectionné : ' + (node.label || nodeId);
            setEditorEnabled(true);
        }

        network.on('selectNode', (params) => {
            selectedNodeId = params.nodes[0];
            loadNodeData(selectedNodeId);
        });

        network.on('deselectNode', () => {
            selectedNodeId = null;
            currentNodeType = null;
            statusEl.textContent = 'Sélectionnez un nœud dans le graphe.';
            labelInput.value = '';
            typeSelect.value = '';
            setEditorEnabled(false);
        });

        function getNodeType(nodeId) {
            const node = nodes.get(nodeId);
            return node ? (node.node_type || node.group || 'unknown') : 'unknown';
        }

        updateBtn.addEventListener('click', () => {
            if (!selectedNodeId) return;
            const newLabel = labelInput.value.trim() || selectedNodeId;
            const newType = typeSelect.value || currentNodeType || 'unknown';
            const style = NODE_TYPES[newType] || NODE_TYPES['unknown'];
            nodes.update({
                id: selectedNodeId,
                label: newLabel,
                shape: style.shape,
                icon: style.icon,
                color: style.color,
                group: newType,
                node_type: newType,
                level: style.level
            });
            currentNodeType = newType;
            typeSelect.value = newType;
            statusEl.textContent = 'Noeud mis à jour : ' + newLabel;
        });

        deleteBtn.addEventListener('click', () => {
            if (!selectedNodeId) return;
            nodes.remove({ id: selectedNodeId });
            selectedNodeId = null;
            currentNodeType = null;
            typeSelect.value = '';
            labelInput.value = '';
            setEditorEnabled(false);
            statusEl.textContent = 'Nœud supprimé. Sélectionnez un autre nœud.';
        });

        function removeSummaryEdges() {
            summaryEdgeIds.forEach((edgeId) => edges.remove(edgeId));
            summaryEdgeIds.clear();
        }

        function createSummaryEdges() {
            removeSummaryEdges();
            const scannerNode = nodes.get().find((node) => getNodeType(node.id) === 'scanner');
            if (!scannerNode) return;
            nodes.forEach((node) => {
                const nodeType = getNodeType(node.id);
                if (['scanner', 'gateway', 'network'].includes(nodeType)) return;
                const summaryId = `summary_${node.id}`;
                if (edges.get(summaryId)) return;
                edges.add({
                    id: summaryId,
                    from: scannerNode.id,
                    to: node.id,
                    dashes: true,
                    color: { color: '#94a3b8', highlight: '#60a5fa' }
                });
                summaryEdgeIds.add(summaryId);
            });
        }

        function updateLinkVisibility() {
            edges.forEach((edge) => {
                if (!baseEdgeIds.has(edge.id)) return;
                const fromType = getNodeType(edge.from);
                const toType = getNodeType(edge.to);
                const hideEdge = simplifiedView && (fromType === 'gateway' || toType === 'gateway');
                edges.update({ id: edge.id, hidden: hideEdge });
            });
            if (simplifiedView) {
                createSummaryEdges();
                toggleHopsBtn.textContent = 'Afficher les liens intermédiaires';
            } else {
                removeSummaryEdges();
                toggleHopsBtn.textContent = 'Masquer les liens intermédiaires';
            }
        }

        toggleHopsBtn.addEventListener('click', () => {
            simplifiedView = !simplifiedView;
            updateLinkVisibility();
        });

        updateLinkVisibility();
        setEditorEnabled(false);
    </script>
</body>
</html>